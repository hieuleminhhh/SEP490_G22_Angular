<div class="container">
  <aside class="sidebar">
    <nav class="sidebar-nav">
      <ul>
        <li>
          <a>QUẢN LÝ BÀN </a>
          <ul>
            <li><a (click)="setView('table-layout')">Sơ đồ bàn</a></li>
            <li><a (click)="setView('booking-request')">Yêu cầu đặt bàn</a></li>
            <li><a (click)="setView('booking-schedule')">Lịch đặt bàn</a></li>
            <li><a (click)="setView('booking-history')">Lịch sử đặt bàn</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </aside>
  <main class="main-content">
    <header>
      <!-- <div class="search-bar">
          <input type="text" placeholder="Search">
        </div>
        <button *ngIf="currentView === 'table-layout'" class="add-table btn" style="margin-left: 200px;">Thêm
          bàn</button> -->
      <h2 *ngIf="currentView === 'table-layout'">Sơ đồ bàn</h2>
      <h2 *ngIf="currentView === 'booking-request'">Yêu cầu đặt bàn</h2>
      <h2 *ngIf="currentView === 'booking-schedule'">Lịch đặt bàn</h2>
      <h2 *ngIf="currentView === 'booking-history'">Lịch sử đặt bàn</h2>
      <h2 *ngIf="currentView === 'detail-reservation'">Chi tiết đơn đặt bàn</h2>
      <select id="timeframe" name="timeframe" *ngIf="currentView === 'booking-schedule'" [(ngModel)]="selectedTime"
        (ngModelChange)="onSelectTimeframe()">
        <option value="today" [selected]="selectedTime === 'today'">Hôm nay</option>
        <option value="this_week" [selected]="selectedTime === 'this_week'">Tuần này</option>
      </select>

    </header>
    <hr>

    <section *ngIf="currentView === 'table-layout'">
      <div class="container">
        <div class="card short-card">
          <div class="table-layout-buttons">
            <button (click)="onSelectFloor1()">Tầng một</button>
            <button (click)="onSelectFloor2()">Tầng hai</button>
          </div>
        </div>

        <div class="card">
          <div class="table-grid">
            <div class="table" *ngFor="let table of dataTable" (click)="assignTable(table.tableId)">
              {{ table.tableId }}<br>
              <hr>{{ table.status === 0 ? 'Bàn trống' : 'Đang sử dụng' }}
              <span class="icon-table" *ngIf="table.status === 1">&#10004;</span>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section *ngIf="currentView === 'booking-schedule'">
      <div class="container">
        <div class="card">
          <div class="reservation-grid">
            <div class="reservation" *ngFor="let reservation of dataReservationAccept; let i = index">
              <div class="row">
                <div class="cell">
                  <span class="data">{{reservation.consigneeName}} - {{reservation.guestPhone}}</span>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-md-3" style="display: flex;justify-content: center;align-items: center;"
                  *ngIf="reservation.tableOfReservation && reservation.tableOfReservation.length > 1">
                  <span class="number-table">{{ reservation.tableOfReservation[0].tableId }}</span>
                  <span style="font-weight: bold;font-size: 24px;cursor: pointer;" (click)="tableDropdown()">...</span>
                  <!-- Dropdown -->
                  <div *ngIf="showDropdown"
                    style="position: absolute; z-index: 1;margin-left: 280px;background-color: white;border: 1px solid black;  display: flex;justify-content: center;">
                    <div *ngFor="let table of reservation.tableOfReservation.slice(1); let i = index">
                      <span class="number-table">{{ table.tableId }}</span>
                    </div>
                  </div>
                </div>

                <div class="col-md-3" style="display: flex;justify-content: center;align-items: center;"
                  *ngIf="reservation.tableOfReservation && reservation.tableOfReservation.length === 1">
                  <span class="number-table">{{ reservation.tableOfReservation[0].tableId }}</span>
                </div>

                <div class="col-md-3" style="display: flex;justify-content: center;align-items: center;"
                  *ngIf="reservation.tableOfReservation && reservation.tableOfReservation.length === 0">
                  <span class="number-table">?</span>
                </div>




                <div class="vertical-line"></div>
                <div class="col-md-8">
                  <div class="row">
                    <div class="col-md-8">
                      <div class="cell">
                        <span>{{ reservation.reservationTime | date:'dd/MM/yyyy HH:mm' }}</span>
                      </div>
                    </div>
                    <div class="vertical-line"></div>
                    <div class="col-md-3">
                      <div class="cell">
                        <span class="data"><i class="fas fa-user"></i> {{reservation.guestNumber}}</span>
                      </div>
                    </div>
                  </div>
                  <hr>
                  <div class="cell">
                    <span class="data"><i class="fas fa-coins"></i> {{reservation.deposits}}</span>
                  </div>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-md-4" style="height: 20px;">
                  <div class="dropdown">
                    <button class="icon" (click)="toggleDropdown(i)">...</button>
                    <div class="dropdown-content" [class.show]="reservation.isDropdownOpen">
                      <a (click)="setView('table-layout')">Xếp bàn</a>
                      <a href="#">Thêm món</a>
                      <a href="#">Hủy đặt bàn</a>
                    </div>
                  </div>
                </div>
                <div class="col-md-8" style="display: flex;justify-content: center;align-items: center;height: 20px;">
                  <span class="label-reser">Khách nhận bàn</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>
    <section *ngIf="currentView === 'booking-request'">
      <div class="container">
        <div class="card">
          <div>
            <table>
              <thead>
                <tr>
                  <th>Tên khách hàng</th>
                  <th>Số điện thoại</th>
                  <th>Ngày giờ nhận bàn</th>
                  <th>Số lượng khách</th>
                  <th>Đặt cọc</th>
                  <th>Tình trạng bàn</th>
                  <th>Trạng thái đơn</th>
                  <th></th>
                </tr>
              </thead>
              <tbody *ngFor="let reservation of dataReservationPending">
                <ng-container>
                  <tr>
                    <td>{{reservation.consigneeName}}</td>
                    <td>{{reservation.guestPhone}}</td>
                    <td>{{ reservation.reservationTime | date:'dd/MM/yyyy - HH:mm' }}</td>
                    <td>{{reservation.guestNumber}}</td>
                    <td>{{reservation.deposits}}</td>
                    <td>{{reservation.statusOfTable}}</td>
                    <td>{{reservation.status}}</td>
                    <td>
                      <button type="button" class="btn btn-primary btn-sm"
                        (click)="getReservationById(reservation.reservationId)">Chi tiết</button>
                    </td>
                  </tr>
                </ng-container>
              </tbody>


            </table>
          </div>
        </div>
      </div>
    </section>
    <section *ngIf="currentView === 'detail-reservation'">

      <div class="container">
        <div class="card" *ngIf="reservationDetail">
          <details open>
            <summary>Thông tin đặt bàn</summary>
            <div class="row">
              <p>Ngày giờ nhận bàn<span>:{{ reservationDetail.reservationTime | date:'dd/MM/yyyy HH:mm' }}</span></p>
              <p>Số lượng khách<span>:{{ reservationDetail.guestNumber}}</span></p>
              <p>Ghi chú<span>:{{ reservationDetail.note }}</span></p>
              <p>Trạng thái đơn<span>:{{ reservationDetail.status }}</span></p>
            </div>
          </details>
          <details>
            <summary>Bàn và khu vực</summary>
            <div class="row">
              <p>Khu vực<span>:Tầng {{ reservationDetail?.tableOfReservation[0]?.floor }}</span></p>
              <p>Bàn<span>:{{ reservationDetail?.tableOfReservation[0]?.tableId }}</span></p>
              <p>Loại bàn<span>:{{ reservationDetail?.tableOfReservation[0]?.capacity }} người</span></p>
            </div>
          </details>
          <details>
            <summary>Thông tin khách hàng</summary>
            <div class="row">
              <p>Họ tên<span>:{{ reservationDetail.consigneeName }}</span></p>
              <p>Số điện thoại<span>:{{ reservationDetail.guestPhone }}</span></p>
              <p>Email<span>:{{ reservationDetail?.email }}</span></p>
              <p>Địa chỉ<span>:{{ reservationDetail?.address }}</span></p>
            </div>
          </details>
          <details>
            <summary>Thông tin đơn hàng</summary>
            <div>
              <div class="cart-container">
                <div class="cart-header" *ngIf="reservationDetail?.order?.orderDetails && reservationDetail.order.orderDetails.length>0">
                  <div class="row">
                    <div class="col-2"></div>
                    <div class="col">
                      <h5><b>Đồ ăn</b></h5>
                    </div>
                    <div class="col">
                      <h5><b>Đơn giá</b></h5>
                    </div>
                    <div class="col">
                      <h5><b>Số lượng</b></h5>
                    </div>
                    <div class="col">
                      <h5><b>Tổng tiền</b></h5>
                    </div>
                  </div>
                </div>
                <div class="cart-items">
                  <div class="row border-top border-bottom" *ngFor="let item of reservationDetail.order.orderDetails">
                    <div class="row main align-items-center">
                      <div class="col-2">
                        <img class="img-fluid" [src]="item.imageUrl" alt="Item Image"
                          style="max-width: 100%; height: 56px;">
                      </div>
                      <div class="col">
                        <div>{{ item.itemName || item.nameCombo }}</div>
                      </div>
                      <div class="col">
                        <div>{{ item.discountedPrice || item.price }}₫</div>
                      </div>
                      <div class="col">
                        <span>{{ item.quantity }}</span>
                      </div>
                      <div class="col price-close" style="align-items:center;">
                        <span class="price">{{ item.unitPrice }}₫</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>
    </section>

    <section *ngIf="currentView === 'booking-history'">

      <p>Nội dung lịch sử đặt bàn ở đây.</p>
    </section>

  </main>
</div>
