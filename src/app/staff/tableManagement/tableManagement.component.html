<app-HeaderOrderStaff></app-HeaderOrderStaff>
<div class="container">

  <!-- <aside class="sidebar">
    <nav class="sidebar-nav">
      <ul>
        <li>
          <a (click)="setView('table-layout')">QU·∫¢N L√ù B√ÄN </a>
          <ul>
            <li><a [class.active]="currentView === 'table-layout'" (click)="setView('table-layout')"
                (click)="getTableData()">S∆° ƒë·ªì b√†n</a></li>
            <li><a [class.active]="currentView === 'booking-request'" (click)="setView('booking-request')"
                (click)="getReservation()">Y√™u c·∫ßu ƒë·∫∑t
                b√†n</a></li>
            <li><a [class.active]="currentView === 'booking-schedule'" (click)="setView('booking-schedule')"
                (click)="getReservationData()">L·ªãch ƒë·∫∑t
                b√†n</a></li>
            <li><a [class.active]="currentView === 'booking-history'" (click)="setView('booking-history')"
                (click)="getReservationList()">L·ªãch s·ª≠ ƒë·∫∑t
                b√†n</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </aside> -->
  <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar" style="padding: 12px;">
    <app-SidebarOrder></app-SidebarOrder>
  </nav>

  <main class="main-content">
    <header>
      <a href="javascript:history.back()" class="back-link">
        <i class="fas fa-arrow-left back-icon"></i>
      </a>
      <h2 *ngIf="currentView === 'table-layout'">S∆° ƒë·ªì b√†n</h2>
      <h2 *ngIf="currentView === 'booking-request'">Y√™u c·∫ßu ƒë·∫∑t b√†n</h2>
      <h2 *ngIf="currentView === 'booking-schedule'">L·ªãch ƒë·∫∑t b√†n</h2>
      <h2 *ngIf="currentView === 'booking-history'">L·ªãch s·ª≠ ƒë·∫∑t b√†n</h2>
      <h2 *ngIf="currentView === 'detail-reservation'">Chi ti·∫øt ƒë∆°n ƒë·∫∑t b√†n</h2>
      <h2 *ngIf="currentView === 'create-reservation'">T·∫°o ƒë∆°n ƒë·∫∑t b√†n</h2>


      <div class="col-md-3" *ngIf="currentView === 'booking-schedule'">
        <div class="input-group">
          <label class="input-group-text" for="dateFrom">T·ª´ ng√†y</label>
          <input type="date" id="dateFrom" class="form-control" [(ngModel)]="dateFrom" [min]="dateNow"
            (change)="onDateFromChange()">
        </div>
      </div>
      <div class="col-md-3" *ngIf="currentView === 'booking-schedule'">
        <div class="input-group">
          <label class="input-group-text" for="dateTo">ƒê·∫øn ng√†y</label>
          <input type="date" id="dateTo" class="form-control" [(ngModel)]="dateTo" [min]="dateFrom"
            (change)="onDateToChange()">
        </div>
      </div>

      <div class="col-md-3" *ngIf="currentView === 'booking-request'">
        <div class="create-reservation">
          <button (click)="setView('create-reservation')">T·∫°o ƒë∆°n ƒë·∫∑t b√†n</button>
        </div>
      </div>

      <select id="timeframe" name="timeframe" *ngIf="currentView === 'table-layout'" [(ngModel)]="selectedTable "
        (ngModelChange)="filterTablesByFloorAndStatus(selectedTable)" class="floor-select"
        style="width: 20%;padding: 5px;">
        <option value="all">T·∫•t c·∫£ ph√≤ng/b√†n</option>
        <option value="empty">Ph√≤ng/b√†n tr·ªëng</option>
      </select>

    </header>
    <hr>
    <div *ngFor="let message of notifications; let i = index" class="notification" [ngClass]="{'show': isVisible[i]}">
      <div class="notification-content">
        <div class="notification-header">
          <h5 class="notification-title">Th√¥ng b√°o</h5>
          <button type="button" class="closenoti" aria-label="Close" (click)="closeNotification(i)">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="notification-body">
          {{ message }}
        </div>
      </div>
    </div>


    <section *ngIf="currentView === 'table-layout'">
      <div class="container">
        <div class="card short-card">
          <div class="table-layout-buttons">
            <button *ngFor="let floor of getFloors()" (click)="getTableOFFloor(floor)"
              [class.active]="selectedFloor === floor">
              {{ floor }}
            </button>
          </div>
        </div>

        <div class="card">
          <div class="table-grid">
            <div class="table" *ngFor="let table of dataTable">
              {{ table.lable }}<br>
              <hr>{{ table.status === 0 ? 'B√†n tr·ªëng' : 'ƒêang s·ª≠ d·ª•ng' }}
              <span class="icon-sl"><i class="fas fa-chair"></i>{{ table.capacity }}</span>
              <span class="icon-table" *ngIf="table.status === 1">&#10004;</span>
              <span class="calendar-icon" *ngIf="table.tableReservations.length >0"
                (click)="openModalSchedule(table.tableReservations)">
                <i class="fas fa-calendar-alt"></i></span>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="reservation-modal-detail" *ngIf="isModalVisibles">
      <div class="modal-content-detail">
        <span class="close-detail" (click)="closeModal()">&times;</span>
        <h2>Th√¥ng tin ƒë·∫∑t b√†n</h2><br>
        <div *ngIf="selectedReservations.length > 0; else noReservations">
          <ul class="reservation-list">
            <li *ngFor="let reservation of selectedReservations" class="reservation-item">
              <p><strong>Kh√°ch h√†ng:</strong> {{ reservation?.consigneeName }}</p>
              <p><strong>Th·ªùi gian nh·∫≠n b√†n:</strong> {{ reservation?.reservationTime | date:'dd/MM/yyyy - HH:mm' }}</p>
              <p><strong>S·ªë l∆∞·ª£ng kh√°ch:</strong> {{ reservation?.guestNumber }}</p>
              <hr />
            </li>
          </ul>
        </div>
        <ng-template #noReservations>
          <p>No reservations found.</p>
        </ng-template>
      </div>
    </div>

    <section *ngIf="currentView === 'create-reservation'">
      <div class="container">
        <form #reservationForm="ngForm" (ngSubmit)="submitForm(reservationForm)" class="reservation-form-new">
          <div class="row-new">
            <div class="col-md-4-new">
              <div class="form-group-new">
                <label for="date-new">Ng√†y <span class="required-new">*</span></label>
                <input id="date-new" type="date" name="date" [(ngModel)]="reservation.date" [min]="minDate"
                  [max]="maxDate" (change)="updateTimes();onFormChange();" class="input-new" required>
              </div>
            </div>
            <div class="col-md-4-new">
              <div class="form-group-new">
                <label for="time-new">Gi·ªù <span class="required-new">*</span></label>
                <select id="time-new" name="time" [(ngModel)]="reservation.time" class="select-new" required
                  #time="ngModel" (change)="onFormChange();">
                  <option value="">Ch·ªçn</option>
                  <option *ngFor="let time of availableTimes" [value]="time">{{ time }}</option>
                </select>
                <div *ngIf="availableTimes.length < 1" class="error-message-new">
                  <small class="text-danger-new">ƒê√£ h·∫øt gi·ªù ƒë·∫∑t b√†n ng√†y h√¥m nay!</small>
                </div>
                <div *ngIf="(time.invalid && (time.dirty || time.touched || formSubmitted) && availableTimes.length>1&&reset)||errorTime">
                  <small class="text-danger">Vui l√≤ng ch·ªçn gi·ªù ƒÉn!</small>
                </div>
              </div>
            </div>
            <div class="col-md-4-new">
              <div class="form-group-new">
                <label for="people-new">S·ªë ng∆∞·ªùi <span class="required-new">*</span></label>
                <input type="number" id="people-new" name="guestNumber" min="1" [(ngModel)]="reservation.people"
                  class="input-new" value="2" required #people="ngModel" (ngModelChange)="onFormChange();">
                <div *ngIf="people.invalid && (people.dirty || people.touched || formSubmitted)"
                  class="error-message-new">
                  <small class="text-danger-new">Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng kh√°ch</small>
                </div>
              </div>
            </div>
          </div>

          <div class="button-container">
            <button *ngIf="showPersonalInfo===false" type="button" (click)="checkAvailability()" class="button-new">
              Ki·ªÉm tra
            </button>
          </div>

          <div *ngIf="showPersonalInfo">
            <div class="row-new">
              <div class="col-md-4-new">
                <div class="form-group-new">
                  <label for="name-new">T√™n ng∆∞·ªùi ƒë·∫∑t <span class="required-new">*</span></label>
                  <input type="text" id="name-new" name="consigneeName" placeholder="Nh·∫≠p t√™n"
                    [(ngModel)]="consigneeName" class="input-new" required #name="ngModel">
                  <div *ngIf="name.invalid && (name.dirty || name.touched || formSubmitted)" class="error-message-new">
                    <small class="text-danger-new">Vui l√≤ng nh·∫≠p T√™n qu√Ω kh√°ch!</small>
                  </div>
                </div>
              </div>
              <div class="col-md-4-new">
                <div class="form-group-new">
                  <label for="phone-new">S·ªë ƒëi·ªán tho·∫°i <span class="required-new">*</span></label>
                  <input type="tel" id="phone-new" name="guestPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
                    [(ngModel)]="guestPhone" class="input-new" required pattern="^0\d{9,10}$" #phone="ngModel">
                  <div *ngIf="phone.invalid && (phone.dirty || phone.touched || formSubmitted)"
                    class="error-message-new">
                    <small class="text-danger-new" *ngIf="phone.errors?.['pattern']">S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10 ho·∫∑c 11
                      ch·ªØ s·ªë!</small>
                    <small class="text-danger-new" *ngIf="phone.errors?.['required'] && !phone.errors?.['pattern']">Vui
                      l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!</small>
                  </div>
                </div>
              </div>
              <div class="col-md-4-new">
                <div class="form-group-new">
                  <label for="email-new">Email</label>
                  <input type="text" id="email-new" name="email" placeholder="Nh·∫≠p email c·ªßa b·∫°n"
                    [(ngModel)]="emailGuest" class="input-new"
                    pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$">
                </div>
              </div>
              <div class="col-md-4-new">
                <div class="form-group-new">
                  <label for="note">Ghi ch√∫</label>
                  <textarea id="notes" name="note" placeholder="Ghi ch√∫" [(ngModel)]="note"></textarea>
                </div>
              </div>
            </div>
            <div class="createlable" *ngIf="selectedTableIds.length>0">
              <p class="createlable-p">B√†n ƒë√£ x·∫øp: </p>
              <span *ngFor="let table of getSelectedTableNames(); let i = index" class="table-createlable-label">
                {{ table }}
              </span>
            </div>
            <div class="button-group-new">
              <button type="button" (click)="openMenuPopup()" class="add-button-new">
                <i class="fas fa-plus"></i> Th√™m m√≥n
              </button>
              <button type="button" (click)="assignTable(dateTime)" class="add-button-new">
                <i class="fas fa-plus"></i> X·∫øp b√†n
              </button>
            </div>
            <br>
            <div *ngIf="message" class="error-message">
              {{ message }}
            </div>
            <div *ngIf="messages.length > 0" class="alert alert-warning">
              <div *ngFor="let msg of messages">
                {{ msg }}
              </div>
            </div>
            <button type="submit" class="button-submit-new">ƒê·∫∑t b√†n</button>
          </div>
          <br>
          <div class="dish" class="cart" *ngIf="cartItems && cartItems.length > 0">
            <table>
              <thead>
                <tr>
                  <th></th>
                  <th>M√≥n ƒÉn</th>
                  <th>Gi√° b√°n</th>
                  <th>S·ªë l∆∞·ª£ng</th>
                  <th>Th√†nh ti·ªÅn</th>
                  <th></th>
                </tr>
              </thead>
              <tbody *ngFor="let item of cartItems">
                <tr>
                  <td><img class="img-fluid" [src]="item.imageUrl" alt="Item Image"
                      style="max-width: 100%; height: 56px;"></td>
                  <td>{{ item.itemName||item.nameCombo }}</td>
                  <td>{{ item.discountedPrice || item.price | currencyFormat}} </td>
                  <td>
                    <div class="quantity-control">
                      <a (click)="decreaseQuantity(item)" class="icon" style="cursor: pointer;">
                        <i class="fas fa-minus" style="color: black; font-size: 10px;"></i>
                      </a>
                      <input type="number" [(ngModel)]="item.quantity" class="quantity-input" [min]="1" [max]="maxValue"
                        (input)="validateInput(item, maxValue)" (keydown)="preventDelete($event, item.quantity)"
                        pattern="[0-9]*" inputmode="numeric" [ngModelOptions]="{standalone: true}"
                        style="appearance: none; -moz-appearance: textfield;" required />
                      <a (click)="increaseQuantity(item)" class="icon" style="cursor: pointer;">
                        <i class="fas fa-plus" style="color: black; font-size: 10px;"></i>
                      </a>
                    </div>
                  </td>
                  <td><span class="price"> {{ getTotalPrice(item) | currencyFormat}}</span></td>
                  <td><button class="delete icon-button" (click)="removeItem(item)">üóëÔ∏è</button></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="summary" *ngIf="cartItems && cartItems.length > 0;">
            <div class="summary-content">
              <p style="font-weight: bold;">T·ªïng c·ªông: <span id="total">{{ getTotalCartPrice() | currencyFormat }}
                </span></p>
            </div>
          </div>
          <div *ngIf="message" class="error-message-new">{{ message }}</div>
        </form>
      </div>
    </section>

    <!-- Modal -->
    <div id="menuModal" class="custom-modal" [ngClass]="{'custom-show-menu': isMenuPopupOpen===true}">
      <div class="custom-modal-dialog" role="document">
        <div class="custom-modal-content">
          <span class="custom-close" (click)="closeMenuPopup()">&times;</span>
          <app-menu [isReser]="true"></app-menu> <!-- Pass the value here -->
        </div>
      </div>
    </div>

    <!-- Modal Structure -->
    <div id="confirmReservationModal" class="modal-custom" [ngClass]="{'show': isConfirmModalOpen}">
      <div class="modal-dialog-custom">
        <div class="modal-content-custom">
          <span class="custom-close" (click)="closeConfirmModal()">&times;</span>
          <h2>X√°c nh·∫≠n ƒë·∫∑t b√†n</h2>

          <div class="modal-body-custom">
            <p><strong>T√™n ng∆∞·ªùi ƒë·∫∑t:</strong> {{ consigneeName }}</p>
            <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> {{ guestPhone }}</p>
            <p><strong>Ng√†y gi·ªù nh·∫≠n b√†n:</strong> {{ reservation.date }} {{ reservation.time }}</p>
            <p><strong>Email:</strong> {{ emailGuest }}</p>
            <p><strong>S·ªë ng∆∞·ªùi:</strong> {{ reservation.people }}</p>
            <p><strong>Ghi ch√∫:</strong> {{ note }}</p>
            <br *ngIf="selectedTableIds.length>0">
            <p *ngIf="selectedTableIds.length>0"><strong>B√†n ƒë√£ ch·ªçn:</strong>
              <span *ngFor="let table of getSelectedTableNames()" class="table-label-custom">{{ table }}</span>
            </p>
            <br>
            <div *ngIf="cartItems && cartItems.length > 0">
              <p><strong>M√≥n ƒÉn ƒë√£ ch·ªçn:</strong></p>
              <table class="cart-items-table">
                <thead>
                  <tr>
                    <th>M√≥n ƒÉn</th>
                    <th>Gi√° b√°n</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>Th√†nh ti·ªÅn</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of cartItems">
                    <td>{{ item.itemName || item.nameCombo }}</td>
                    <td>{{ item.discountedPrice || item.price | currencyFormat}} </td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ getTotalPrice(item) | currencyFormat }}</td>
                  </tr>
                </tbody>
              </table>
              <div class="summary-content">
                <p style="font-weight: bold;">T·ªïng c·ªông: <span id="total">{{ getTotalCartPrice() | currencyFormat }}
                  </span></p>
              </div>
            </div>
          </div>
          <!-- Confirmation Buttons -->
          <div class="modal-footer-custom">
            <button type="button" class="confirm-button" (click)="createReservation()">X√°c nh·∫≠n</button>
            <button type="button" class="cancel-button" (click)="closeConfirmModal()">H·ªßy</button>
          </div>
        </div>
      </div>
    </div>

    <section *ngIf="currentView === 'booking-schedule'">
      <div class="container">
        <div class="card">
          <div class="reservation-grid">
            <div class="reservation" *ngFor="let reservation of dataReservationAccept; let i = index"
              [ngClass]="getReservationClass(reservation.reservationTime)">
              <div class="row">
                <div class="cell">
                  <span class="data">{{reservation.consigneeName}} - {{reservation.guestPhone}}</span>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-md-3" style="display: flex; justify-content: center; align-items: center;"
                  *ngIf="reservation.tableOfReservation && reservation.tableOfReservation.length > 1">
                  <span class="number-table">{{ reservation.tableOfReservation[0].lable }}</span>
                  <span style="font-weight: bold; font-size: 24px; cursor: pointer;"
                    (click)="openTableModal(i)">...</span>
                </div>
                <div class="custom-modal-detail" *ngIf="showModals[i]">
                  <div class="custom-modal-detail-content">
                    <h2>Danh s√°ch c√°c b√†n ƒë√£ x·∫øp </h2>
                    <div *ngFor="let table of reservation.tableOfReservation">
                      <span class="number-table">{{ table.lable }}</span>
                    </div>
                    <button (click)="closeTableModal(i)">ƒê√≥ng</button>
                  </div>
                </div>
                <div class="custom-modal-detail-overlay" *ngIf="showModals[i]"></div>

                <div class="col-md-3" style="display: flex;justify-content: center;align-items: center;"
                  *ngIf="reservation.tableOfReservation && reservation.tableOfReservation.length === 1">
                  <span class="number-table">{{ reservation.tableOfReservation[0].lable }}</span>
                </div>

                <div class="col-md-3" style="display: flex;justify-content: center;align-items: center;"
                  *ngIf="reservation.tableOfReservation && reservation.tableOfReservation.length === 0">
                  <span class="number-table">?</span>
                </div>
                <div class="vertical-line"></div>
                <div class="col-md-8">
                  <div class="row">
                    <div class="col-md-8">
                      <div class="cell">
                        <span>{{ reservation.reservationTime | date:'dd/MM/yyyy HH:mm' }}</span>
                      </div>
                    </div>
                    <div class="vertical-line"></div>
                    <div class="col-md-3" style="display: flex;justify-content: center;align-items: center;">
                      <div class="cell">
                        <span class="data"><i class="fas fa-user"></i> {{reservation.guestNumber}}</span>
                      </div>
                    </div>
                  </div>
                  <hr>
                  <div class="cell">
                    <span class="data"><i class="fas fa-coins"></i> {{reservation.deposits | currencyFormat}}</span>
                  </div>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-md-4" style="height: 20px;">
                  <div class="dropdown" style="position: relative;display: inline-block;">
                    <button class="icon" (click)="toggleDropdown(i)">...</button>
                    <div class="dropdown-content" [class.show]="reservation.isDropdownOpen">
                      <a *ngIf="reservation.tableOfReservation.length===0"
                        (click)="openPopup(reservation.reservationId,reservation.reservationTime,reservation.tableOfReservation )">X·∫øp
                        b√†n</a>
                      <a *ngIf="reservation.tableOfReservation.length>0"
                        (click)="openPopup(reservation.reservationId,reservation.reservationTime,reservation.tableOfReservation)">Thay
                        ƒë·ªïi
                        b√†n</a>
                      <a *ngIf="reservation.tableOfReservation.length>0"
                        (click)="getReservationById(reservation.reservationId)">Chi ti·∫øt</a>
                      <a (click)="openCancelModal(reservation)">H·ªßy ƒë·∫∑t b√†n</a>
                    </div>
                  </div>
                </div>
                <div class="col-md-8" style="display: flex;justify-content: center;align-items: center;height: 20px;">
                  <span class="label-reser"
                    (click)="checkAndConfirmReservation(reservation.reservationId, 3, reservation.order?.orderId, reservation?.reservationTime, reservation.tableOfReservation, i)"
                    [class.disabled]="!reservation.tableOfReservation || reservation.tableOfReservation.length === 0"
                    *ngIf="reservation.tableOfReservation && reservation.tableOfReservation.length > 0 ">
                    Kh√°ch nh·∫≠n b√†n
                  </span>
                </div>

              </div>
            </div>
          </div>

          <div *ngIf="!dataReservationAccept || dataReservationAccept.length === 0" style="text-align: center;">
            <p>Kh√¥ng c√≥ ƒë∆°n ƒë·∫∑t b√†n cho ng√†y h√¥m nay</p>
          </div>
          <div class="pagination" *ngIf="totalPages > 0">
            <button (click)="onPreviousPage()" [disabled]="currentPage === 1">
              <i class="fas fa-arrow-left"></i> <!-- Icon m≈©i t√™n tr√°i -->
            </button>

            <input type="number" [(ngModel)]="currentPage" (keyup.enter)="goToDesiredPage()" min="1"
              max="{{ totalPages }}">

            <span>of {{ totalPages }}</span>

            <button (click)="onNextPage()" [disabled]="currentPage === totalPages">
              <i class="fas fa-arrow-right"></i> <!-- Icon m≈©i t√™n ph·∫£i -->
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="isModalVisible" class="reservation-backdrop"></div>
      <div class="reservation-modal" [ngStyle]="{'display': isModalVisible ? 'block' : 'none'}">
        <div class="reservation-modal-content">
          <h4>X√°c nh·∫≠n kh√°ch nh·∫≠n b√†n</h4><br>
          <p class="modal-text">H·ªç t√™n: {{guestInfo?.consigneeName}}</p>
          <p class="modal-text">S·ªë ƒëi·ªán tho·∫°i: {{guestInfo?.guestPhone}}</p>
          <p class="modal-text">S·ªë l∆∞·ª£ng ng∆∞·ªùi: {{guestInfo?.guestNumber}} ng∆∞·ªùi</p>
          <p class="modal-text">Th·ªùi gian ƒë·∫∑t b√†n: {{guestInfo?.reservationTime | date:'dd/MM/yyyy - HH:mm' }}</p>
          <p *ngIf="modalMessage" class="modal-text" style="color: red;">{{ modalMessage }}</p>
          <p *ngIf="modalMessage" class="modal-text" style="color: red;">B·∫°n c√≥ ch·∫Øc cho kh√°ch nh·∫≠n nh·∫≠n b√†n?</p>
        </div>
        <div *ngIf="messageerrorTable" class="alert alert-danger" style="color: red; margin-top: 10px;">
          {{ messageerrorTable }}
        </div>
        <div *ngIf="errorMessages" class="alert alert-danger" style="max-width: 500px;">
          {{ errorMessages }}
        </div>
        <div class="reservation-modal-footer">
          <button (click)="confirmReservation()">X√°c nh·∫≠n</button>
          <button (click)="cancelReservation()">H·ªßy</button>
        </div>
      </div>

      <!-- Confirm Save Modal -->
      <div class="modal fade" id="confirmSaveModal" tabindex="-1" role="dialog" aria-labelledby="confirmSaveModalLabel"
        >
        <div class="modal-dialog" role="document">
          <div class="modal-content" style="width: 110%;margin: 60% 110%;">
            <div class="modal-header">
              <h5 class="modal-title" id="confirmSaveModalLabel">X√°c nh·∫≠n x·∫øp b√†n</h5>
              <span type="button" class="close" data-dismiss="modal" aria-label="Close"
                (click)="closeConfirmSaveModal()">
                <span aria-hidden="true">&times;</span>
              </span>
            </div>
            <div class="modal-body">
              B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng k√Ω ph√≤ng/b√†n sau cho ƒë∆°n n√†y kh√¥ng?
              <ul style="margin-left: 20px;">
                {{ getSelectedTableNames().join(', ') }}
              </ul>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal"
                (click)="closeConfirmSaveModal()">H·ªßy</button>
              <button type="button" class="btn btn-primary" (click)="confirmSave()">X√°c nh·∫≠n</button>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Main Modal -->
    <div class="modal fade" id="updateTimeModal" tabindex="-1" role="dialog" aria-labelledby="updateTimeModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content" style="overflow: auto;">
          <div class="modal-header">
            <h5 class="modal-title" id="updateTimeModalLabel">ƒêƒÉng k√Ω b√†n</h5>
            <div class="text-center text-white flex-fill" style="font-size: 18px;">
              {{ reservationTimeSelected | date: 'dd/MM/yyyy - HH:mm' }}
            </div>
            <span type="button" class="close" data-dismiss="modal" aria-label="Close"
              (click)="closePopup()">&times;</span>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="table-status-container">
                <div>X·∫øp b√†n cho {{guestNumber}} ng∆∞·ªùi:</div>

                <div class="selected-tables-container" *ngIf="getSelectedTableNames().length > 0">
                  <span>ƒê√£ ch·ªçn:</span>
                  <span *ngFor="let table of getSelectedTableNames(); let i = index" class="table-label">
                    {{ table }}
                    <span (click)="removeTable(i)" class="remove-button">&times;</span>
                  </span>
                </div>

                <span *ngIf="getSelectedTableNames().length === 0">
                  Ch∆∞a ch·ªçn ph√≤ng/b√†n
                </span>

                <div class="checkbox-container">
                  <label *ngIf="ishas === false">
                    <i class="fas fa-times-circle" style="color: red;"></i>
                    <span style="color: red;">Ch∆∞a ƒë·ªß</span>
                  </label>
                  <label *ngIf="ishas === true">
                    <i class="fas fa-check-circle" style="color: green;"></i>
                    <span style="color: green;">ƒê√£ ƒë·ªß</span>
                  </label>
                </div>
              </div>

              <div *ngIf="!showPersonalInfo" class="col-md-3"
                style="display: flex; justify-content: center; align-items: center;">
                <select id="floor" name="floor" [(ngModel)]="selectedFloor"
                  (change)="getTableOFFloorEmpty(selectedFloor,reservationTimeSelected)" class="floor-select">
                  <option *ngFor="let floor of getFloors()" [value]="floor" [class.active]="selectedFloor === floor">
                    {{ floor }}
                  </option>
                </select>
              </div>
              <div *ngIf="showPersonalInfo" class="col-md-3"
                style="display: flex; justify-content: center; align-items: center;">
                <select id="floor" name="floor" [(ngModel)]="selectedFloor"
                  (change)="getTableOFFloorEmpty(selectedFloor,dateTime)" class="floor-select">
                  <option *ngFor="let floor of getFloors()" [value]="floor" [class.active]="selectedFloor === floor">
                    {{ floor }}
                  </option>
                </select>
              </div>
              <div class="col-md-7">
                <div class="card" style="max-height: 400px; overflow: auto;">
                  <div class="table-grid">
                    <div class="table" *ngFor="let table of tableEmpty" (click)="toggleTableSelection(table)">
                      {{ table.lable }}<br>
                      <span class="icon-sl">
                        <i class="fas fa-chair"></i>{{ table.capacity }}
                      </span>
                      <span class="icon-table" style="left: 170px;"
                        *ngIf="selectedTableIds.includes(table.tableId)">&#10004;</span>
                    </div>
                  </div>
                  <div *ngIf="tableEmpty.length < 1" style="height: 100px;">
                    <p>Khu v·ª±c n√†y kh√¥ng c√≤n ph√≤ng/b√†n tr·ªëng</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="validMessage" class="alert alert-danger" style="color: red; margin-top: 10px;">
            {{ validMessage }}
          </div>
          <div class="modal-footer">
            <button type="button" style="background-color: red;" class="btn btn-secondary"
              (click)="closePopup()">ƒê√≥ng</button>
            <button *ngIf="showPersonalInfo === false" type="button" class="btn btn-primary"
              (click)="openConfirmSaveModal()">L∆∞u
              thay ƒë·ªïi</button>
            <button *ngIf="showPersonalInfo===true" type="button" class="btn btn-primary"
              (click)="closeTableAssignPopup()">L∆∞u
              thay ƒë·ªïi</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Confirm Cancel Modal -->
    <div class="reservation-cancel-modal" *ngIf="showCancelModal">
      <div class="reservation-cancel-modal-content">
        <h2>X√°c nh·∫≠n h·ªßy ƒë·∫∑t b√†n</h2>
        <label for="cancelReason">L√Ω do h·ªßy:</label>
        <textarea id="cancelReason" [(ngModel)]="cancelReason" rows="4" style="width: 100%;"></textarea>
        <div *ngIf="errorMessage" class="alert alert-danger" style="color: red; margin-top: 10px;">
          {{ errorMessage }}
        </div>
        <div style="margin-top: 20px;">
          <button class="confirm-button" (click)="confirmCancel($event)">X√°c nh·∫≠n</button>
          <button class="cancel-button" (click)="closeCancelModal()">ƒê√≥ng</button>
        </div>
      </div>
    </div>
    <div class="reservation-cancel-modal-overlay" *ngIf="showCancelModal"></div>

    <!-- Confirm Accept Modal -->
    <div class="reservation-accept-modal" *ngIf="showAcceptModal">
      <div class="reservation-accept-modal-content">
        <h2>X√°c nh·∫≠n ch·∫•p nh·∫≠n ƒë·∫∑t b√†n</h2><br>
        <div class="reservation-detail">
          <p><strong>Kh√°ch h√†ng:</strong> {{ detailRes?.consigneeName }}</p>
          <p><strong>Th·ªùi gian nh·∫≠n b√†n:</strong> {{ detailRes?.reservationTime | date:'dd/MM/yyyy - HH:mm' }}</p>
          <p><strong>S·ªë l∆∞·ª£ng kh√°ch:</strong> {{ detailRes?.guestNumber }}</p>
        </div>
        <div *ngIf="message" class="error-message">
          {{ message }}
        </div>
        <div style="margin-top: 20px;">
          <button class="confirm-button" (click)="confirmAccept($event)">X√°c nh·∫≠n</button>

          <button class="cancel-button" (click)="closeAcceptModal()">ƒê√≥ng</button>
        </div>
      </div>
    </div>
    <div class="reservation-accept-modal-overlay" *ngIf="showAcceptModal"></div>
    <section *ngIf="currentView === 'booking-request'">
      <div class="container">
        <div class="card">
          <div>
            <table>
              <thead>
                <tr>
                  <th>T√™n kh√°ch h√†ng</th>
                  <th>S·ªë ƒëi·ªán tho·∫°i</th>
                  <th>Ng√†y gi·ªù nh·∫≠n b√†n</th>
                  <th>S·ªë l∆∞·ª£ng kh√°ch</th>
                  <th>ƒê·∫∑t c·ªçc</th>
                  <th>Tr·∫°ng th√°i ƒë∆°n</th>
                  <th></th>
                  <th></th>
                  <th></th>
                </tr>
              </thead>
              <tbody *ngFor="let reservation of dataReservationPending">
                <ng-container>
                  <tr>
                    <td>{{reservation.consigneeName}}</td>
                    <td>{{reservation.guestPhone}}</td>
                    <td>{{ reservation.reservationTime | date:'dd/MM/yyyy - HH:mm' }}</td>
                    <td>{{reservation.guestNumber}}</td>
                    <td>{{reservation.deposits | currencyFormat}}</td>
                    <td><span [ngClass]="getStatusLabel(reservation.status).class" class="status-label">{{
                        getStatusLabel(reservation.status).label }}</span></td>
                    <td>
                      <button type="button" class="btn btn-primary btn-sm"
                        (click)="getReservationById(reservation.reservationId)">Chi ti·∫øt</button>
                    </td>
                    <td><button type="button" class="btn btn-primary btn-sm" style="background-color: green;"
                        (click)="openAcceptModal(reservation)">Nh·∫≠n ƒë∆°n</button></td>
                    <td>
                      <button type="button" class="btn btn-primary btn-sm" style="background-color: red;"
                        (click)="openCancelModal(reservation)">H·ªßy ƒë∆°n</button>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
          <br>
          <div *ngIf="!dataReservationPending || dataReservationPending.length === 0" style="text-align: center;">
            <p>Kh√¥ng c√≥ y√™u c·∫ßu ƒë·∫∑t b√†n </p>
          </div>
          <div class="pagination" *ngIf="totalPages > 0">
            <button (click)="onPreviousPage()" [disabled]="currentPage === 1">
              <i class="fas fa-arrow-left"></i> <!-- Icon m≈©i t√™n tr√°i -->
            </button>

            <input type="number" [(ngModel)]="currentPage" (keyup.enter)="goToDesiredPage()" min="1"
              max="{{ totalPages }}">

            <span>of {{ totalPages }}</span>

            <button (click)="onNextPage()" [disabled]="currentPage === totalPages">
              <i class="fas fa-arrow-right"></i> <!-- Icon m≈©i t√™n ph·∫£i -->
            </button>
          </div>

        </div>
      </div>
    </section>
    <section *ngIf="currentView === 'detail-reservation'">

      <div class="container">
        <div class="card" *ngIf="reservationDetail">
          <details open>
            <summary>Th√¥ng tin ƒë·∫∑t b√†n</summary>
            <div class="row">
              <p>Ng√†y gi·ªù nh·∫≠n b√†n<span>:{{ reservationDetail.data.reservationTime | date:'dd/MM/yyyy HH:mm' }}</span>
              </p>
              <p>S·ªë l∆∞·ª£ng kh√°ch<span>:{{ reservationDetail.data.guestNumber}}</span></p>
              <p>Ghi ch√∫<span>:{{ reservationDetail.data.note }}</span></p>
              <p>Tr·∫°ng th√°i ƒë∆°n<span [ngClass]="getStatusLabel(reservationDetail.data.status).class">:{{
                  getStatusLabel(reservationDetail.data.status).label }}</span></p>
            </div>
          </details>
          <details>
            <summary>Ph√≤ng/B√†n v√† khu v·ª±c</summary>
            <div class="row" *ngIf="reservationDetail?.data.tableOfReservation.length > 0">
              <div [innerHTML]="formatTables(reservationDetail?.data.tableOfReservation)"></div>
            </div>
          </details>
          <details>
            <summary>Th√¥ng tin kh√°ch h√†ng</summary>
            <div class="row">
              <p>H·ªç t√™n<span>:{{ reservationDetail.data.consigneeName }}</span></p>
              <p>S·ªë ƒëi·ªán tho·∫°i<span>:{{ reservationDetail.data.guestPhone }}</span></p>
              <p>Email<span>:{{ reservationDetail?.data.email }}</span></p>
              <p>ƒê·ªãa ch·ªâ<span>:{{ reservationDetail?.data.address }}</span></p>
            </div>
          </details>
          <details>
            <summary>Th√¥ng tin ƒë∆°n h√†ng</summary>
            <div>
              <div class="cart-container">
                <div class="cart-header"
                  *ngIf="reservationDetail?.data.order?.orderDetails && reservationDetail.data.order.orderDetails.length>0">
                  <div class="row">
                    <div class="col-2"></div>
                    <div class="col">
                      <h5><b>ƒê·ªì ƒÉn</b></h5>
                    </div>
                    <div class="col">
                      <h5><b>ƒê∆°n gi√°</b></h5>
                    </div>
                    <div class="col">
                      <h5><b>S·ªë l∆∞·ª£ng</b></h5>
                    </div>
                    <div class="col">
                      <h5><b>T·ªïng ti·ªÅn</b></h5>
                    </div>
                  </div>
                </div>
                <div class="cart-items">
                  <div class="row border-top border-bottom"
                    *ngFor="let item of reservationDetail?.data?.order?.orderDetails">
                    <div class="row main align-items-center">
                      <div class="col-2">
                        <img class="img-fluid" [src]="item.imageUrl" alt="Item Image"
                          style="max-width: 100%; height: 56px;">
                      </div>
                      <div class="col">
                        <div>{{ item.itemName || item.nameCombo }}</div>
                      </div>
                      <div class="col">
                        <div>{{ item.discountedPrice || item.price | currencyFormat}}</div>
                      </div>
                      <div class="col">
                        <span>{{ item.quantity }}</span>
                      </div>
                      <div class="col price-close" style="align-items:center;">
                        <span class="price">{{ item.unitPrice | currencyFormat}}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>
    </section>


    <section *ngIf="currentView === 'booking-history'">
      <div class="container">
        <div class="card">
          <div class="tabs">
            <button class="tab" *ngFor="let tab of tabs; let i = index" [class.active]="i === selectedIndex"
              (click)="selectTab(i)">
              {{ tab }}
            </button>
            <input type="text" placeholder="Nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm..." [(ngModel)]="searchTerm"
              (input)="onSearchChange($event)">
          </div>
          <br>
          <div>
            <table>
              <thead>
                <tr>
                  <th>T√™n kh√°ch h√†ng</th>
                  <th>S·ªë ƒëi·ªán tho·∫°i</th>
                  <th>Ng√†y gi·ªù nh·∫≠n b√†n</th>
                  <th>S·ªë l∆∞·ª£ng kh√°ch</th>
                  <th>ƒê·∫∑t c·ªçc</th>
                  <th>Khu v·ª±c, b√†n</th>
                  <th>Tr·∫°ng th√°i ƒë∆°n</th>
                  <th></th>
                </tr>
              </thead>
              <tbody *ngFor="let reservation of dataReservation">
                <ng-container>
                  <tr>
                    <td>{{reservation.consigneeName}}</td>
                    <td>{{reservation.guestPhone}}</td>
                    <td>{{ reservation.reservationTime | date:'dd/MM/yyyy - HH:mm' }}</td>
                    <td>{{reservation.guestNumber}}</td>
                    <td>{{reservation.deposits | currencyFormat}}</td>
                    <td>
                      <div [innerHTML]="formatTables(reservation.tableOfReservation)"></div>
                    </td>
                    <td>
                      <span [ngClass]="getStatusLabel(reservation.status).class" class="status-label">{{
                        getStatusLabel(reservation.status).label }}</span>
                    </td>


                    <td>
                      <button type="button" class="btn btn-primary btn-sm"
                        (click)="getReservationById(reservation.reservationId)">Chi ti·∫øt</button>
                    </td>
                  </tr>
                </ng-container>
              </tbody>


            </table>
          </div>
          <br>
          <div *ngIf="!dataReservation || dataReservation.length === 0" style="text-align: center;">
            <p>Kh√¥ng c√≥ d·ªØ li·ªáu </p>
          </div>
          <div class="pagination" *ngIf="totalPages > 0">
            <button (click)="onPreviousPage()" [disabled]="currentPage === 1">
              <i class="fas fa-arrow-left"></i> <!-- Icon m≈©i t√™n tr√°i -->
            </button>

            <input type="number" [(ngModel)]="currentPage" (keyup.enter)="goToDesiredPage()" min="1"
              max="{{ totalPages }}">

            <span>of {{ totalPages }}</span>

            <button (click)="onNextPage()" [disabled]="currentPage === totalPages">
              <i class="fas fa-arrow-right"></i> <!-- Icon m≈©i t√™n ph·∫£i -->
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
