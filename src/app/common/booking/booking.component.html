<div class="dish">
  <table class="cart" *ngIf="cartItems && cartItems.length > 0; else noItems">
    <thead>
      <tr>
        <th></th>
        <th>M√≥n ƒÉn</th>
        <th>Gi√° b√°n</th>
        <th>S·ªë l∆∞·ª£ng</th>
        <th>Th√†nh ti·ªÅn</th>
        <th></th>
      </tr>
    </thead>
    <tbody *ngFor="let item of cartItems">
      <tr>
        <td><img class="img-fluid" [src]="item.imageUrl" alt="Item Image" style="max-width: 100%; height: 56px;"></td>
        <td>{{ item.itemName||item.nameCombo }}</td>
        <td>{{ item.discountedPrice || item.price | currencyFormat}} </td>
        <td>
          <a (click)="decreaseQuantity(item)" class="icon" style="cursor: pointer;">
            <i class="fas fa-minus" style="color: black; font-size: 10px;"></i>
          </a>
          <input type="number" [(ngModel)]="item.quantity" class="quantity-input" [min]="1" [max]="maxValue"
                      (input)="validateInput(item, maxValue)" (keydown)="preventDelete($event, item.quantity)"
                      pattern="[0-9]*" inputmode="numeric" style="appearance: none; -moz-appearance: textfield;"
                      required />
          <a (click)="increaseQuantity(item)" class="icon" style="cursor: pointer;">
            <i class="fas fa-plus" style="color: black; font-size: 10px;"></i>
          </a>
        </td>
        <td><span class="price"> {{ getTotalPrice(item) | currencyFormat}}</span></td>
        <td><button class="delete icon-button" (click)="removeItem(item)">üóëÔ∏è</button></td>
      </tr>
    </tbody>
  </table>
</div>

<div class="summary" *ngIf="cartItems && cartItems.length > 0;">
  <div class="summary-content">
    <a (click)="openMenuPopup()"><i class="fas fa-arrow-left"></i>Ti·∫øp t·ª•c ch·ªçn m√≥n</a>
    <p>T·ªïng c·ªông: <span id="total">{{ getTotalCartPrice() | currencyFormat }} </span></p>
  </div>
</div>

<ng-template #noItems>
  <div class="empty-cart">
    <div class="content">
      <p class="center-text">Qu√Ω kh√°ch c√≥ mu·ªën ch·ªçn m√≥n ngay kh√¥ng?</p>
      <div class="right-content" (click)="openMenuPopup()">
        <a><i class="fas fa-plus-circle icon"></i></a>
        <p>ƒê·∫∑t tr∆∞·ªõc m√≥n</p>
      </div>
    </div>
  </div>
</ng-template>

<!-- Modal -->
<div id="menuModal" class="modal" [ngClass]="{'show': isMenuPopupOpen}">
  <div class="modal-dialog" role="document"></div>
  <div class="modal-content">
    <span class="close" (click)="closeMenuPopup()">&times;</span>
    <app-menu [isReser]="true"  [modalTitle]="'Custom Menu Title'"></app-menu> <!-- Pass the value here -->
  </div>
</div>


<div class="reservation-form" style="max-height: 500px;">
  <h2>ƒê·∫∑t B√†n</h2>
  <form #reservationForm="ngForm" (ngSubmit)="submitForm(reservationForm)">
    <div class="row">
      <div class="col-md-4">
        <div class="form-group">
          <label for="email">
            T√™n ng∆∞·ªùi ƒë·∫∑t <span style="color: red;">*</span>
          </label>
          <input type="text" id="name" name="consigneeName" placeholder="Nh·∫≠p t√™n" [(ngModel)]="consigneeName" required
            #name="ngModel">
          <div *ngIf="name.invalid && (name.dirty || name.touched || formSubmitted)">
            <small class="text-danger">Vui l√≤ng nh·∫≠p T√™n qu√Ω kh√°ch!</small>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="form-group">
          <label for="email">
            S·ªë ƒëi·ªán tho·∫°i <span style="color: red;">*</span>
          </label>
          <input type="tel" id="phone" name="guestPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" [(ngModel)]="guestPhone"
            required pattern="^0\d{9,10}$" #phone="ngModel">
          <div *ngIf="phone.invalid && (phone.dirty || phone.touched || formSubmitted)">
            <small class="text-danger" *ngIf="phone.errors?.['pattern']">
              S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10 ho·∫∑c 11 ch·ªØ s·ªë!
            </small>
            <small class="text-danger" *ngIf="phone.errors?.['required'] && !phone.errors?.['pattern']">
              Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!
            </small>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="form-group">
          <label for="email">
            Email <span style="color: red;">*</span>
          </label>
          <input type="text" id="email" name="email" placeholder="Nh·∫≠p email c·ªßa b·∫°n" [(ngModel)]="emailGuest" required
            email pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$" #email="ngModel">

          <div *ngIf="email.invalid && (email.dirty || email.touched || formSubmitted)">
            <small class="text-danger" *ngIf="email.errors?.['required']">
              Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ email!
            </small>
            <small class="text-danger" *ngIf="email.errors?.['pattern']">
              ƒê·ªãa ch·ªâ email kh√¥ng h·ª£p l·ªá!
            </small>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-4">
        <div class="form-group">
          <label for="email">
            Ng√†y<span style="color: red;">*</span>
          </label>
          <input id="date" type="date" name="date" [(ngModel)]="reservation.date" [min]="minDate" [max]="maxDate"
            (change)="updateTimes()" style="width: 100%;height: 40px;">
        </div>
      </div>
      <div class="col-md-4">
        <div class="form-group">
          <label for="email">
            Gi·ªù<span style="color: red;">*</span>
          </label>
          <select id="time" name="time" [(ngModel)]="reservation.time" required #time="ngModel">
            <option value="">Ch·ªçn</option>
            <option *ngFor="let time of availableTimes" [value]="time">{{ time }}</option>
          </select>
          <div *ngIf="availableTimes.length<1">
            <small class="text-danger">ƒê√£ h·∫øt gi·ªù ƒë·∫∑t b√†n ng√†y h√¥m nay!</small>
          </div>
          <div *ngIf="time.invalid && (time.dirty || time.touched || formSubmitted) && availableTimes.length>1">
            <small class="text-danger">Vui l√≤ng ch·ªçn gi·ªù ƒÉn!</small>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="form-group">
          <label for="email">
            S·ªë ng∆∞·ªùi<span style="color: red;">*</span>
          </label>
          <input type="number" id="people" name="guestNumber" min="1" [(ngModel)]="reservation.people" value="2"
            required #people="ngModel">
          <div *ngIf="people.invalid && (people.dirty || people.touched || formSubmitted)">
            <small class="text-danger">Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng kh√°ch</small>
          </div>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label for="email">
        Ghi ch√∫
      </label>
      <textarea id="notes" name="note" placeholder="Ghi ch√∫" [(ngModel)]="note"></textarea>
    </div>
    <div *ngIf="message" class="error-message">
      {{ message }}
    </div>
    <div *ngIf="messages.length > 0" class="alert alert-warning">
      <div *ngFor="let msg of messages">
        {{ msg }}
      </div>
    </div>
    <button type="submit">ƒê·∫∑t b√†n</button>
  </form>
  <p class="note">
    L∆ØU √ù: Ch·ªâ khi nh·∫≠n ƒë∆∞·ª£c cu·ªôc g·ªçi t·ª´ nh√¢n vi√™n ƒë·ªÉ x√°c nh·∫≠n ƒë∆°n ƒë·∫∑t b√†n, y√™u c·∫ßu c·ªßa b·∫°n m·ªõi ƒë∆∞·ª£c coi l√† ƒë·∫∑t b√†n
    th√†nh c√¥ng.
  </p>
</div>
